# 🚀 Project Neon V2.5 前端对接文档

## 第一步：启动后端服务

### Windows
```bash
双击运行 start.bat
```

### Linux/Mac
```bash
chmod +x start.sh
./start.sh
```

## 第二步：访问 API 文档

打开浏览器访问：
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

---

## API 接口说明

### 基础信息
- 基础 URL: `http://localhost:8000`
- 认证方式: Bearer Token (JWT)
- 请求头: `Authorization: Bearer {access_token}`

---

## 1. 认证模块 `/auth`

### 1.1 用户注册
```
POST /auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "username": "username",
  "password": "password123"  // 至少8位，包含字母和数字
}

响应 201:
{
  "id": 1,
  "email": "user@example.com",
  "username": "username",
  "avatar": null,
  "is_verified": false,
  "created_at": "2025-12-13T10:00:00"
}
```

**注意**: 注册成功后会发送验证邮件（如已配置邮件服务）

### 1.2 用户登录
```
POST /auth/login
Content-Type: application/x-www-form-urlencoded

username=user@example.com&password=password123

响应 200:
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "abc123xyz...",
  "token_type": "bearer",
  "is_verified": false
}
```

**重要变更**: 登录现在返回双 Token！
- `access_token`: 30分钟有效，用于 API 请求
- `refresh_token`: 7天有效，用于刷新 access_token
- `is_verified`: 邮箱是否已验证

### 1.3 刷新 Token (新增)
```
POST /auth/refresh
Content-Type: application/json

{
  "refresh_token": "abc123xyz..."
}

响应 200:
{
  "access_token": "新的access_token",
  "refresh_token": "新的refresh_token",
  "token_type": "bearer",
  "is_verified": true
}
```

**使用场景**: 当 access_token 过期时，用 refresh_token 获取新的双 Token

### 1.4 用户登出 (新增)
```
POST /auth/logout
Content-Type: application/json

{
  "refresh_token": "abc123xyz..."
}

响应 200:
{
  "success": true
}
```

### 1.5 邮箱验证 (新增)
```
POST /auth/verify-email
Content-Type: application/json

{
  "code": "验证码字符串"
}

响应 200:
{
  "success": true,
  "message": "邮箱验证成功"
}
```

### 1.6 重发验证邮件 (新增)
```
POST /auth/resend-verify
Content-Type: application/json

{
  "email": "user@example.com"
}

响应 200:
{
  "success": true,
  "message": "验证邮件已发送"
}
```

### 1.7 忘记密码 (新增)
```
POST /auth/forgot-password
Content-Type: application/json

{
  "email": "user@example.com"
}

响应 200:
{
  "success": true,
  "message": "重置邮件已发送"
}
```

**邮件内容**: 用户会收到包含重置链接的邮件，链接格式为：
```
{FRONTEND_URL}/reset-password?code=xxx
```

### 1.8 重置密码 (新增)
```
POST /auth/reset-password
Content-Type: application/json

{
  "code": "重置码字符串",
  "new_password": "newpassword123"
}

响应 200:
{
  "success": true,
  "message": "密码重置成功"
}
```

**⚠️ 前端必须实现 `/reset-password` 页面**：

```tsx
// ResetPassword.tsx 示例
import { useSearchParams } from 'react-router-dom';

function ResetPassword() {
  const [searchParams] = useSearchParams();
  const code = searchParams.get('code');  // 从 URL 获取 code
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');

  const handleSubmit = async () => {
    if (password !== confirmPassword) {
      toast.error('两次密码不一致');
      return;
    }
    
    const res = await fetch('/auth/reset-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code, new_password: password })
    });
    
    if (res.ok) {
      toast.success('密码重置成功');
      navigate('/login');
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input type="password" placeholder="新密码" onChange={e => setPassword(e.target.value)} />
      <input type="password" placeholder="确认密码" onChange={e => setConfirmPassword(e.target.value)} />
      <button type="submit">重置密码</button>
    </form>
  );
}
```

**路由配置**：
```tsx
<Route path="/reset-password" element={<ResetPassword />} />
```

### 1.9 获取当前用户信息
```
GET /auth/me
Headers: Authorization: Bearer {token}

响应 200:
{
  "id": 1,
  "email": "user@example.com",
  "username": "username",
  "avatar": "/uploads/avatars/xxx.jpg",
  "is_verified": true,
  "created_at": "2025-12-13T10:00:00"
}
```

### 1.10 更新用户信息
```
PUT /auth/me
Headers: Authorization: Bearer {token}
Content-Type: application/json

{
  "username": "新用户名",
  "avatar": "头像URL"
}

响应 200: 返回更新后的用户信息
```

### 1.11 上传头像 (新增)
```
POST /auth/me/avatar
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data

file: 图片文件 (JPEG/PNG/WebP, 最大2MB)

响应 200: 返回更新后的用户信息
```

### 1.12 获取用户统计
```
GET /auth/me/stats
Headers: Authorization: Bearer {token}

响应 200:
{
  "post_count": 10,
  "like_count": 25,
  "favorite_count": 8,
  "comment_count": 15
}
```

---

## 2. 用户模块 `/users` (新增)

### 2.1 获取用户主页
```
GET /users/{user_id}

响应 200:
{
  "id": 1,
  "username": "username",
  "email": "user@example.com",
  "avatar": "/uploads/avatars/xxx.jpg",
  "is_verified": true,
  "created_at": "2025-12-13T10:00:00",
  "post_count": 10,
  "following_count": 50,
  "follower_count": 100,
  "is_following": false  // 当前登录用户是否关注了此用户
}
```

### 2.2 获取用户动态
```
GET /users/{user_id}/posts?page=1&page_size=20

响应 200:
{
  "total": 100,
  "page": 1,
  "page_size": 20,
  "items": [...]
}
```

### 2.3 关注用户
```
POST /users/{user_id}/follow
Headers: Authorization: Bearer {token}

响应 200:
{
  "success": true,
  "action": "followed"
}
```

### 2.4 取消关注
```
DELETE /users/{user_id}/follow
Headers: Authorization: Bearer {token}

响应 200:
{
  "success": true,
  "action": "unfollowed"
}
```

### 2.5 获取关注列表
```
GET /users/{user_id}/following?page=1&page_size=20

响应 200:
{
  "total": 50,
  "page": 1,
  "page_size": 20,
  "items": [
    {
      "id": 2,
      "username": "user2",
      "avatar": "/uploads/avatars/xxx.jpg"
    }
  ]
}
```

### 2.6 获取粉丝列表
```
GET /users/{user_id}/followers?page=1&page_size=20

响应 200: 格式同上
```

---

## 3. 动态模块 `/posts`

### 3.1 发布动态
```
POST /posts/
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data

content: "动态内容"
category_id: 1  // 可选
files: [图片/视频文件]  // 可选，支持多文件

响应 201: 返回动态详情
```

**⚠️ 文件上传限制 (V2.5.1)**：
- ✅ 支持：图片文件 (JPEG, PNG, GIF, WebP)
- ✅ 支持：视频文件 (MP4, WebM 等)
- ❌ 不支持：其他文件类型 (PDF, 文档, 压缩包等)
- 上传不支持的文件类型会返回 400 错误：`{"error_code": "invalid_file_type", "message": "只支持上传图片和视频文件"}`

### 3.2 获取动态列表
```
GET /posts/?page=1&page_size=20&category_id=1&user_id=1

响应 200:
{
  "total": 100,
  "page": 1,
  "page_size": 20,
  "items": [
    {
      "id": 1,
      "user_id": 1,
      "content": "动态内容",
      "media_type": "image",
      "media_urls": ["/uploads/images/xxx.jpg", "/uploads/images/yyy.jpg"],  // ⚠️ 已改为数组格式
      "category_id": 1,
      "repost_source_id": null,
      "created_at": "2025-12-13T10:00:00",
      "like_count": 10,
      "comment_count": 5,
      "view_count": 100,
      "is_liked": false,
      "is_collected": false,
      "user": {
        "id": 1,
        "username": "用户名",
        "avatar": "头像URL"
      }
    }
  ]
}
```

**⚠️ V2.3 变更**: `media_urls` 现在直接返回数组，不再是 JSON 字符串，前端无需再 `JSON.parse()`

### 3.3 获取我的动态
```
GET /posts/me?page=1&page_size=20
Headers: Authorization: Bearer {token}

响应 200: 格式同上
```

### 3.4 获取动态详情
```
GET /posts/{id}

响应 200: 返回单个动态详情
```

### 3.5 编辑动态
```
PUT /posts/{id}
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data

content: "更新后的内容"

响应 200: 返回更新后的动态
```

### 3.6 删除动态
```
DELETE /posts/{id}
Headers: Authorization: Bearer {token}

响应 200:
{
  "success": true
}
```

### 3.7 点赞/收藏
```
POST /posts/{id}/interact
Headers: Authorization: Bearer {token}
Content-Type: application/json

{
  "interaction_type": "like"  // 或 "bookmark"
}

响应 200:
{
  "action": "added"  // 或 "removed"
}
```

### 3.8 发表评论
```
POST /posts/{id}/comments
Headers: Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "评论内容"
}

响应 201: 返回评论详情
```

### 3.9 获取评论列表
```
GET /posts/{id}/comments

响应 200: 返回评论数组
```

### 3.10 转发动态
```
POST /posts/{id}/repost
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data

content: "转发时的评论"

响应 201: 返回新动态
```

---

## 4. 图库模块 `/gallery`

### 4.1 获取分类列表
```
GET /gallery/categories

响应 200:
[
  {
    "id": 1,
    "name": "进击的巨人",
    "cover_image": "/uploads/covers/xxx.jpg"
  }
]
```

### 4.2 获取分类图片
```
GET /gallery/{category_id}?page=1&page_size=30

响应 200:
{
  "category": {...},
  "total": 150,
  "page": 1,
  "page_size": 30,
  "items": [...]
}
```

---

## 5. 通知模块 `/notifications`

### 5.1 获取通知列表
```
GET /notifications/?page=1&page_size=20&unread_only=true
Headers: Authorization: Bearer {token}

响应 200:
{
  "total": 5,
  "page": 1,
  "page_size": 20,
  "items": [
    {
      "id": 1,
      "user_id": 1,
      "actor_id": 2,
      "actor_username": "用户名",
      "actor_avatar": "头像URL",
      "type": "like",  // like/comment/follow/repost
      "post_id": 10,
      "is_read": false,
      "created_at": "2025-12-13T10:00:00"
    }
  ]
}
```

### 5.2 标记单条已读
```
POST /notifications/{id}/read
Headers: Authorization: Bearer {token}

响应 200:
{
  "success": true
}
```

### 5.3 全部标记已读
```
POST /notifications/read-all
Headers: Authorization: Bearer {token}

响应 200:
{
  "success": true,
  "count": 5
}
```

---

## 6. 搜索模块 `/search`

### 6.1 搜索动态
```
GET /search/posts?q=关键词&page=1&page_size=20

响应 200: 分页动态列表
```

### 6.2 搜索用户
```
GET /search/users?q=关键词&page=1&page_size=20

响应 200: 分页用户列表
```

---

## 7. AI 助手 `/ai` - Mu 主脑

### 7.1 与 Mu 对话
```
POST /ai/chat
Headers: Authorization: Bearer {token}
Content-Type: application/json

{
  "message": "你好"
}

响应 200:
{
  "user_message": {
    "id": 1,
    "role": "user",
    "content": "你好",
    "created_at": "2025-12-13T10:00:00"
  },
  "assistant_message": {
    "id": 2,
    "role": "assistant",
    "content": "你好呀～欢迎来到闪电社区。我是 Mu，这里的主脑。有什么我可以帮你的吗？✨",
    "created_at": "2025-12-13T10:00:01"
  }
}
```

**关于 Mu**:
- Mu 是闪电社区的中心主脑 AI，拥有独特的人格设定
- 四重身份：客服、主脑、情感陪伴、世界观 NPC
- 说话风格：温柔、理性、高级、克制、有未来感
- 支持对话历史记忆，能记住与用户的聊天内容

---

## 8. 系统配置 `/system`

### 8.1 获取网站配置 (V2.5 新版)
```
GET /system/config

响应 200:
{
  // 品牌信息
  "site_name": "LETAVERSE",
  "site_name_cn": "莱塔宇宙",
  "community_name": "Lightning Community",
  "community_name_cn": "闪电社区",
  "slogan": "The soul is infinite...",
  "slogan_cn": "灵魂无限...",
  
  // 视觉资源
  "logo": "/uploads/images/logo.png",
  "favicon": "/uploads/images/favicon.ico",
  "background": "/uploads/images/bg.jpg",
  "hero_background": "/uploads/images/hero.jpg",
  "ai_kanban": "/uploads/images/kanban.png",
  "default_avatar": "/uploads/images/avatar.png",
  
  // 首页内容
  "intro": {
    "en": "Welcome to LETAVERSE...",
    "zh": "欢迎来到莱塔宇宙..."
  },
  "world_background": {
    "en": "...",
    "zh": "..."
  },
  
  // 社交链接
  "social_links": [
    {"name": "Instagram", "url": "https://...", "icon": "instagram"},
    {"name": "哔哩哔哩", "url": "https://...", "icon": "bilibili"}
  ],
  
  // 功能开关
  "features": {
    "ai_chat": true,
    "registration": true,
    "email_verify": false
  },
  
  // AI 助手
  "ai": {
    "name": "Mu AI",
    "name_cn": "穆爱",
    "title": "Central Brain",
    "title_cn": "中枢脑",
    "greeting": "Hello~ I'm Mu ✨",
    "greeting_cn": "你好呀～我是穆爱 ✨"
  }
}
```

**⚠️ 重要：前端必须使用这些配置！**

这些配置在管理后台修改后，前端需要：
1. 启动时调用此 API 获取配置
2. 用配置值替换硬编码的内容
3. 刷新页面后生效

**前端使用示例**：
```javascript
// 启动时获取配置
const config = await fetch('/system/config').then(r => r.json());

// 使用配置 - 支持中英双语
const lang = 'zh'; // 或 'en'
document.title = lang === 'zh' ? config.site_name_cn : config.site_name;
document.querySelector('.logo').src = config.logo;
document.querySelector('.hero-bg').style.backgroundImage = `url(${config.hero_background})`;

// AI 页面使用
const aiName = lang === 'zh' ? config.ai.name_cn : config.ai.name;
const aiGreeting = lang === 'zh' ? config.ai.greeting_cn : config.ai.greeting;

// 社交链接
config.social_links.forEach(link => {
  console.log(link.name, link.url, link.icon);
});
```

**配置项说明**：
| 配置项 | 前端用途 |
|--------|----------|
| site_name / site_name_cn | 网站标题(英/中) |
| community_name_cn | 社区名称 |
| logo | 网站 Logo 图片 |
| background | 全局背景图 |
| hero_background | 首页 Hero 背景 |
| ai_kanban | AI 看板娘图片 |
| ai.name_cn | AI 助手中文名 |
| ai.greeting_cn | AI 欢迎语 |
| social_links | 社交媒体链接数组 |
| ai.welcome_message | AI 聊天页首条消息 |

---

## 错误码说明

所有错误响应格式：
```json
{
  "error_code": "错误码",
  "message": "错误码"
}
```

### 认证相关
| 错误码 | 说明 |
|--------|------|
| invalid_credentials | 用户名或密码错误 |
| unauthorized | 未授权，请先登录 |
| invalid_refresh_token | 无效的刷新令牌 |
| user_not_found | 用户不存在 |
| user_banned | 用户已被封禁（见下方详细说明） |
| email_already_exists | 邮箱已被注册 |
| username_already_exists | 用户名已被使用 |
| email_already_verified | 邮箱已验证 |
| verification_code_expired | 验证码已过期 |
| verification_code_used | 验证码已使用 |
| invalid_verification_code | 无效的验证码 |

### 用户封禁 (V2.4 新增)
当用户被封禁时，任何需要认证的 API 都会返回 403 错误：
```json
{
  "error_code": "user_banned",
  "message": "user_banned",
  "reason": "违反社区规定",
  "until": "2025-12-20T00:00:00"  // null 表示永久封禁
}
```

**前端处理建议**：
```javascript
if (error.response?.data?.error_code === 'user_banned') {
  const { reason, until } = error.response.data;
  const msg = until 
    ? `账号已被封禁至 ${new Date(until).toLocaleDateString()}，原因：${reason}`
    : `账号已被永久封禁，原因：${reason}`;
  showAlert(msg);
  logout();  // 清除本地 token
}
```

### 密码相关
| 错误码 | 说明 |
|--------|------|
| password_too_short | 密码长度至少8个字符 |
| password_needs_letter | 密码必须包含字母 |
| password_needs_number | 密码必须包含数字 |

### 关注相关
| 错误码 | 说明 |
|--------|------|
| cannot_follow_self | 不能关注自己 |
| already_following | 已经关注 |
| not_following | 未关注 |

### 文件相关
| 错误码 | 说明 |
|--------|------|
| invalid_file_type | 不支持的文件格式（发帖只支持图片和视频） |
| file_too_large | 文件太大 |
| invalid_avatar_type | 不支持的头像格式 |
| avatar_too_large | 头像文件太大 |

### 内容相关
| 错误码 | 说明 |
|--------|------|
| post_not_found | 动态不存在 |
| category_not_found | 分类不存在 |

### AI 相关
| 错误码 | 说明 |
|--------|------|
| ai_service_not_configured | AI 服务未配置 |
| ai_service_error | AI 服务错误 |

---

## 前端集成建议

### Token 管理
```javascript
// 存储 Token
localStorage.setItem('access_token', response.access_token);
localStorage.setItem('refresh_token', response.refresh_token);

// 请求拦截器 - 自动添加 Token
axios.interceptors.request.use(config => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器 - 自动刷新 Token
axios.interceptors.response.use(
  response => response,
  async error => {
    if (error.response?.status === 401) {
      const refreshToken = localStorage.getItem('refresh_token');
      if (refreshToken) {
        try {
          const res = await axios.post('/auth/refresh', { refresh_token: refreshToken });
          localStorage.setItem('access_token', res.data.access_token);
          localStorage.setItem('refresh_token', res.data.refresh_token);
          // 重试原请求
          error.config.headers.Authorization = `Bearer ${res.data.access_token}`;
          return axios(error.config);
        } catch {
          // 刷新失败，跳转登录
          localStorage.clear();
          window.location.href = '/login';
        }
      }
    }
    return Promise.reject(error);
  }
);
```

### 错误处理
```javascript
const errorMessages = {
  invalid_credentials: "用户名或密码错误",
  unauthorized: "请先登录",
  password_too_short: "密码长度至少8个字符",
  password_needs_letter: "密码必须包含字母",
  password_needs_number: "密码必须包含数字",
  email_already_exists: "邮箱已被注册",
  username_already_exists: "用户名已被使用",
  cannot_follow_self: "不能关注自己",
  // ... 更多错误码
};

function handleError(error) {
  const code = error.response?.data?.error_code;
  const message = errorMessages[code] || "操作失败，请重试";
  showToast(message);
}
```

---

## 9. 管理后台

### 访问地址
```
http://localhost:8000/admin
```

### 默认管理员
- 用户名: `admin`
- 密码: `Admin123`

### 创建新管理员
```bash
python init_admin.py 用户名 密码
# 或交互式创建
python init_admin.py
```

### 管理后台功能
| 功能 | 说明 |
|------|------|
| 用户管理 | 查看、搜索、编辑用户信息 |
| 动态管理 | 查看、搜索、删除动态 |
| 分类管理 | 增删改查番剧分类 |
| 评论管理 | 查看、删除评论 |
| 通知管理 | 查看、删除通知 |
| 网站配置 | 修改网站名称、Logo、颜色等 |
| 媒体库 | 管理上传的图片和视频 |
| 管理员管理 | 管理管理员账户（仅超级管理员） |

### 管理员角色
| 角色 | 权限 |
|------|------|
| super_admin | 所有权限，包括管理其他管理员 |
| operator | 基础管理权限，不能管理管理员 |

### 网站配置项
在管理后台可以修改以下配置，前端通过 `/system/config` 获取：

| 配置项 | 说明 |
|--------|------|
| site_name | 网站名称 |
| site_description | 网站描述 |
| site_intro | 网站介绍 |
| site_logo | Logo 图片 URL |
| site_favicon | Favicon URL |
| site_background | 背景图片 URL |
| primary_color | 主题色 |
| banner_images | 轮播图 (JSON 数组) |
| nav_labels | 导航菜单标签 (JSON) |
| button_labels | 按钮文字 (JSON) |
| social_links | 社交链接 (JSON 数组) |
| footer_links | 页脚链接 (JSON 数组) |
| enable_ai_chat | 是否启用 AI 聊天 |
| enable_registration | 是否启用用户注册 |
| require_email_verify | 是否要求邮箱验证 |

---

## 10. API 限流保护 (V2.3 新增)

为防止滥用，以下接口有请求频率限制：

| 接口 | 限制 | 说明 |
|------|------|------|
| POST /auth/register | 3次/分钟 | 注册 |
| POST /auth/login | 5次/分钟 | 登录 |
| POST /auth/forgot-password | 3次/分钟 | 忘记密码 |
| POST /auth/reset-password | 3次/分钟 | 重置密码 |
| POST /ai/chat | 10次/分钟 | AI 对话 |
| POST /posts/ | 20次/分钟 | 发布动态 |

**超出限制响应**:
```
HTTP 429 Too Many Requests
{
  "error": "Rate limit exceeded: 5 per 1 minute"
}
```

**前端处理建议**:
```javascript
if (error.response?.status === 429) {
  showToast("操作太频繁，请稍后再试");
}
```

---

## 11. 图片自动压缩 (V2.3 新增)

上传图片时，后端会自动进行压缩处理：

| 配置项 | 值 |
|--------|-----|
| 最大尺寸 | 1920 x 1920 像素 |
| JPEG 质量 | 85% |
| PNG | 优化压缩 |
| WebP | 85% 质量 |
| GIF | 保持原样（保留动画） |

**说明**: 前端无需做任何处理，上传原图即可，后端会自动优化。

---

---

## 12. 邮件服务配置 (SMTP)

邮箱验证和密码重置功能需要配置 SMTP 邮件服务。

### 配置方法

编辑项目根目录的 `.env` 文件，添加以下配置：

```bash
# 邮件服务配置
SMTP_HOST=smtp.qq.com          # SMTP 服务器地址
SMTP_PORT=587                   # SMTP 端口 (通常 587 或 465)
SMTP_USER=your_email@qq.com     # 发件邮箱
SMTP_PASSWORD=your_auth_code    # 邮箱授权码（不是登录密码！）
FROM_EMAIL=your_email@qq.com    # 发件人地址

# 前端 URL (用于生成验证链接)
FRONTEND_URL=http://localhost:5173
```

### 常用邮箱 SMTP 配置

| 邮箱服务 | SMTP 服务器 | 端口 | 说明 |
|----------|-------------|------|------|
| QQ 邮箱 | smtp.qq.com | 587 | 需要开启 SMTP 服务并获取授权码 |
| 163 邮箱 | smtp.163.com | 465 | 需要开启 SMTP 服务并获取授权码 |
| Gmail | smtp.gmail.com | 587 | 需要开启"应用专用密码" |
| Outlook | smtp.office365.com | 587 | 使用账户密码 |

### QQ 邮箱配置步骤

1. 登录 QQ 邮箱网页版
2. 进入「设置」→「账户」
3. 找到「POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务」
4. 开启「SMTP 服务」
5. 按提示发送短信获取「授权码」
6. 将授权码填入 `.env` 的 `SMTP_PASSWORD`

### 163 邮箱配置步骤

1. 登录 163 邮箱网页版
2. 进入「设置」→「POP3/SMTP/IMAP」
3. 开启「SMTP 服务」
4. 设置「客户端授权密码」
5. 将授权密码填入 `.env` 的 `SMTP_PASSWORD`

### 测试邮件服务

配置完成后，重启服务器，然后：

1. 注册新用户 → 应收到验证邮件
2. 点击「忘记密码」→ 应收到重置邮件

如果未收到邮件，检查：
- `.env` 配置是否正确
- 授权码是否正确（不是登录密码）
- 邮件是否在垃圾箱
- 服务器日志是否有错误信息

### 未配置邮件服务时

如果不配置 SMTP，系统仍可正常运行，但：
- 注册时不会发送验证邮件
- 忘记密码功能无法使用
- 用户的 `is_verified` 始终为 `false`

---

## 需要帮助？

- API 文档: http://localhost:8000/docs
- 管理后台: http://localhost:8000/admin
- 详细开发文档: `PROJECT_NEON_开发文档.md`
- 项目说明: `README.md`

---

**更新日期**: 2025-12-14
**版本**: V2.5

## 更新日志

### V2.5.2 (2025-12-15)
- ✅ 修复管理后台时间显示问题：所有时间现在显示为北京时间（UTC+8）
- ✅ 新增初始化脚本功能：支持从前端 public 目录自动复制默认图片到媒体库
- ✅ 初始化脚本支持命令行参数指定前端目录路径

### V2.5.1 (2025-12-15)
- ✅ 发帖文件上传限制：只允许上传图片和视频，其他文件类型会返回错误
- ✅ 代码推送到 GitHub 仓库

### V2.5 (2025-12-14)
- ✅ 重新设计网站配置功能，支持中英双语
- ✅ 新增配置分类：品牌信息、AI助手、视觉资源、首页内容、社交链接、功能开关
- ✅ 配置项命名兼容（支持 site_logo 和 logo 两种格式）
- ✅ 媒体库添加图片预览功能
- ✅ 网站配置长文本显示优化（截断显示）

### V2.4.1 (2025-12-13)
- ✅ 修复收藏功能 `is_collected` 状态不正确的问题
- ✅ 添加可选认证依赖，登录用户可正确获取点赞/收藏状态
- ✅ 配置 SMTP 邮件服务（支持 QQ 邮箱）
- ✅ 邮箱验证和密码重置功能已可用

### V2.4 (2025-12-13)
- ✅ 用户封禁功能（管理后台可封禁/解封用户）
- ✅ 操作日志（记录管理员所有操作）
- ✅ AI 提示词可配置（管理后台可修改 Mu 的人设）
- ✅ 封禁用户访问 API 返回 403 + 封禁原因

### V2.3 (2025-12-13)
- ✅ `media_urls` 返回格式改为数组（原为 JSON 字符串）
- ✅ 新增 API 限流保护
- ✅ 新增图片自动压缩

### V2.2 (2025-12-13)
- 管理后台仪表盘和报表功能

### V2.1 (2025-12-12)
- 双 Token 认证机制
- 邮箱验证功能
- 用户关注系
