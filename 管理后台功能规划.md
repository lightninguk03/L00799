# 📋 Project Neon 管理后台功能规划

## 🔍 现有功能问题分析

### 问题 1：网站配置不好用

**当前问题**：
- 运营人员需要手动填写图片 URL，不知道怎么上传图片
- JSON 格式配置（如 `banner_images`、`social_links`）对非技术人员不友好
- 没有配置预览功能
- 前端需要调用 `/system/config` 获取配置，但没有说明文档

**解决方案**：
1. 添加图片上传功能到配置页面
2. 为 JSON 配置提供可视化编辑器
3. 添加配置说明和示例
4. 确保前端正确使用配置 API

**前端配合**：
- 前端需要在启动时调用 `GET /system/config` 获取配置
- 用返回的配置动态渲染网站名称、Logo、主题色等
- 示例代码已在 `快速开始.md` 中提供

### 问题 2：AI 提示词写死在代码里

**当前问题**：
- Mu 的人设提示词硬编码在 `app/api/v1/ai.py`
- 运营人员无法调整 AI 的性格、回复风格
- 修改需要改代码并重启服务

**解决方案**：
- 将 AI 提示词移到数据库配置
- 管理后台添加 AI 设置页面
- 支持实时修改，无需重启

---

## 当前已实现功能

### ✅ 基础功能
| 功能 | 状态 | 说明 |
|------|------|------|
| 管理员登录/登出 | ✅ 完成 | Session 认证 |
| 用户管理 | ✅ 完成 | 查看、搜索、编辑（不可创建/删除） |
| 动态管理 | ✅ 完成 | 查看、搜索、删除（不可创建） |
| 分类管理 | ✅ 完成 | 增删改查 |
| 评论管理 | ✅ 完成 | 查看、删除 |
| 通知管理 | ✅ 完成 | 查看、删除 |
| 网站配置 | ✅ 完成 | 修改各项配置 |
| 媒体库 | ✅ 完成 | 查看上传的文件 |
| 管理员管理 | ✅ 完成 | 仅超级管理员可见 |

### ✅ 数据统计
| 功能 | 状态 | 说明 |
|------|------|------|
| 仪表盘 | ✅ 完成 | 总览统计、今日数据、最近数据 |
| 数据报表 | ✅ 完成 | 趋势图表、分类统计、TOP 排行 |
| CSV 导出 | ✅ 完成 | 用户/动态/评论导出 |

---

## 🔴 缺失功能（建议优先实现）

### 1. 内容审核系统
**优先级：高** | **复杂度：中**

当前问题：
- 没有内容举报机制
- 没有违规内容标记
- 没有审核队列

建议实现：
```
- 用户举报功能（前端 + 后端 API）
- 举报管理页面（管理后台）
- 内容状态：正常/待审核/已隐藏/已删除
- 批量审核操作
```

数据模型：
```python
class Report(SQLModel, table=True):
    id: int
    reporter_id: int      # 举报人
    target_type: str      # post/comment/user
    target_id: int        # 被举报内容 ID
    reason: str           # 举报原因
    status: str           # pending/resolved/rejected
    handler_id: int       # 处理人
    created_at: datetime
    resolved_at: datetime
```

### 2. 用户封禁功能
**优先级：高** | **复杂度：低**

当前问题：
- 无法禁止违规用户
- 没有封禁记录

建议实现：
```
- User 模型添加 is_banned, banned_until, ban_reason 字段
- 管理后台添加封禁/解封操作
- 登录时检查封禁状态
- 封禁历史记录
```

### 3. 操作日志
**优先级：中** | **复杂度：低**

当前问题：
- 管理员操作无记录
- 无法追溯问题

建议实现：
```python
class AdminLog(SQLModel, table=True):
    id: int
    admin_id: int
    action: str           # create/update/delete/ban/unban
    target_type: str      # user/post/comment/config
    target_id: int
    details: str          # JSON 详情
    ip_address: str
    created_at: datetime
```

### 4. 系统公告
**优先级：中** | **复杂度：低**

当前问题：
- 无法发布系统公告
- 无法通知所有用户

建议实现：
```python
class Announcement(SQLModel, table=True):
    id: int
    title: str
    content: str
    type: str             # info/warning/important
    is_active: bool
    start_time: datetime
    end_time: datetime
    created_by: int
    created_at: datetime
```

前端 API：`GET /system/announcements`

### 5. 敏感词过滤
**优先级：中** | **复杂度：中**

当前问题：
- 没有内容过滤机制
- 违规内容可直接发布

建议实现：
```
- 敏感词库管理
- 发布内容自动检测
- 命中敏感词：拦截/替换/标记审核
```

---

## 🟡 可选功能（后续迭代）

### 6. 数据备份
**优先级：低** | **复杂度：中**

```
- 数据库备份（SQLite 文件复制）
- 定时自动备份
- 备份文件下载
- 数据恢复
```

### 7. 邮件模板管理
**优先级：低** | **复杂度：低**

```
- 验证邮件模板
- 密码重置邮件模板
- 通知邮件模板
- 可视化编辑
```

### 8. AI 对话管理
**优先级：低** | **复杂度：低**

```
- 查看用户与 AI 的对话记录
- AI 回复质量监控
- Mu 人设配置（System Prompt 可编辑）
```

### 9. 关注关系管理
**优先级：低** | **复杂度：低**

```
- 查看关注/粉丝关系
- 关注数据统计
- 异常关注检测（刷粉）
```

### 10. 互动数据管理
**优先级：低** | **复杂度：低**

```
- 点赞/收藏记录查看
- 互动数据统计
- 异常互动检测（刷赞）
```

---

## 📊 功能对比表

| 功能 | 当前状态 | 优先级 | 复杂度 | 建议 |
|------|----------|--------|--------|------|
| 内容审核 | ❌ 缺失 | 🔴 高 | 中 | V2.4 实现 |
| 用户封禁 | ❌ 缺失 | 🔴 高 | 低 | V2.4 实现 |
| 操作日志 | ❌ 缺失 | 🟡 中 | 低 | V2.4 实现 |
| 系统公告 | ❌ 缺失 | 🟡 中 | 低 | V2.5 实现 |
| 敏感词过滤 | ❌ 缺失 | 🟡 中 | 中 | V2.5 实现 |
| 数据备份 | ❌ 缺失 | 🟢 低 | 中 | 后续考虑 |
| 邮件模板 | ❌ 缺失 | 🟢 低 | 低 | 后续考虑 |
| AI 对话管理 | ❌ 缺失 | 🟢 低 | 低 | 后续考虑 |
| 关注管理 | ❌ 缺失 | 🟢 低 | 低 | 后续考虑 |
| 互动管理 | ❌ 缺失 | 🟢 低 | 低 | 后续考虑 |

---

## 🚀 建议实现顺序

### V2.4 版本（安全与审核）
1. **用户封禁功能** - 1-2 小时
   - 添加封禁字段
   - 管理后台封禁操作
   - 登录检查

2. **操作日志** - 2-3 小时
   - 日志模型
   - 记录关键操作
   - 日志查看页面

3. **内容审核基础** - 3-4 小时
   - 举报模型
   - 举报 API
   - 举报管理页面

### V2.5 版本（运营工具）
1. 系统公告
2. 敏感词过滤
3. 数据备份

---

## 💡 前端需要的管理后台 API

如果前端需要调用管理后台功能，建议添加以下 API：

```
# 系统公告（公开）
GET /system/announcements

# 举报（需登录）
POST /reports
  - target_type: post/comment/user
  - target_id: int
  - reason: string

# 封禁检查（登录时自动）
- 返回 403 + ban_reason + banned_until
```

---

**更新日期**: 2025-12-13
**当前版本**: V2.3
