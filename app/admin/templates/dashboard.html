{% extends "layout.html" %}

{% block content %}
<div class="container-fluid">
    <!-- 页面标题 -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-0">
                <i class="fa-solid fa-chart-line me-2"></i>仪表盘
            </h2>
            <p class="text-muted mb-0">欢迎回来，{{ admin_name }}！这是系统概览。</p>
        </div>
    </div>

    <!-- 统计卡片 -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #4e73df !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">用户总数</div>
                            <div class="h3 mb-0 font-weight-bold text-primary">{{ stats.users }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-users fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #1cc88a !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">动态总数</div>
                            <div class="h3 mb-0 font-weight-bold text-success">{{ stats.posts }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-newspaper fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #36b9cc !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">评论总数</div>
                            <div class="h3 mb-0 font-weight-bold text-info">{{ stats.comments }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-comments fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #f6c23e !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">分类数量</div>
                            <div class="h3 mb-0 font-weight-bold text-warning">{{ stats.categories }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-folder fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 第二行统计 -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #e74a3b !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">媒体文件</div>
                            <div class="h3 mb-0 font-weight-bold text-danger">{{ stats.media }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-images fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #858796 !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">未读通知</div>
                            <div class="h3 mb-0 font-weight-bold text-secondary">{{ stats.unread_notifications }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-bell fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #5a5c69 !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">今日新用户</div>
                            <div class="h3 mb-0 font-weight-bold">{{ stats.today_users }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-user-plus fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #6f42c1 !important;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs text-uppercase text-muted mb-1">今日动态</div>
                            <div class="h3 mb-0 font-weight-bold" style="color: #6f42c1;">{{ stats.today_posts }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-plus-circle fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 最近数据 -->
    <div class="row">
        <!-- 最近用户 -->
        <div class="col-xl-6 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fa-solid fa-user-clock me-2"></i>最近注册用户
                    </h6>
                    <a href="{{ request.url_for('admin:list', identity='user') }}" class="btn btn-sm btn-outline-primary">
                        查看全部
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>注册时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in recent_users %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if user.avatar %}
                                            <img src="{{ user.avatar }}" class="rounded-circle me-2" width="32" height="32" alt="">
                                            {% else %}
                                            <div class="rounded-circle bg-secondary me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                                <i class="fa-solid fa-user text-white"></i>
                                            </div>
                                            {% endif %}
                                            {{ user.username }}
                                        </div>
                                    </td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.created_at.strftime('%m-%d %H:%M') }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center text-muted py-4">暂无数据</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最近动态 -->
        <div class="col-xl-6 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-success">
                        <i class="fa-solid fa-newspaper me-2"></i>最近发布动态
                    </h6>
                    <a href="{{ request.url_for('admin:list', identity='post') }}" class="btn btn-sm btn-outline-success">
                        查看全部
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>内容</th>
                                    <th>作者</th>
                                    <th>发布时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for post in recent_posts %}
                                <tr>
                                    <td>
                                        <div class="text-truncate" style="max-width: 200px;">
                                            {{ post.content[:50] }}{% if post.content|length > 50 %}...{% endif %}
                                        </div>
                                    </td>
                                    <td>{{ post.user.username if post.user else '未知' }}</td>
                                    <td>{{ post.created_at.strftime('%m-%d %H:%M') }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center text-muted py-4">暂无数据</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 最近评论 -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-info">
                        <i class="fa-solid fa-comments me-2"></i>最近评论
                    </h6>
                    <a href="{{ request.url_for('admin:list', identity='comment') }}" class="btn btn-sm btn-outline-info">
                        查看全部
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>评论内容</th>
                                    <th>评论者</th>
                                    <th>动态ID</th>
                                    <th>评论时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for comment in recent_comments %}
                                <tr>
                                    <td>
                                        <div class="text-truncate" style="max-width: 300px;">
                                            {{ comment.content[:80] }}{% if comment.content|length > 80 %}...{% endif %}
                                        </div>
                                    </td>
                                    <td>{{ comment.user.username if comment.user else '未知' }}</td>
                                    <td>#{{ comment.post_id }}</td>
                                    <td>{{ comment.created_at.strftime('%m-%d %H:%M') }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-4">暂无数据</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统信息 -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="m-0 font-weight-bold text-secondary">
                        <i class="fa-solid fa-server me-2"></i>系统信息
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <p class="mb-2"><strong>应用名称：</strong>{{ system_info.app_name }}</p>
                            <p class="mb-2"><strong>版本：</strong>{{ system_info.version }}</p>
                        </div>
                        <div class="col-md-4">
                            <p class="mb-2"><strong>数据库：</strong>SQLite</p>
                            <p class="mb-2"><strong>框架：</strong>FastAPI + SQLAdmin</p>
                        </div>
                        <div class="col-md-4">
                            <p class="mb-2"><strong>管理员数量：</strong>{{ stats.admins }}</p>
                            <p class="mb-2"><strong>配置项数量：</strong>{{ stats.configs }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.text-xs {
    font-size: 0.7rem;
}
.card {
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}
